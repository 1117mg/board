<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>회원 관리</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/aside.css">
    <link rel="stylesheet" href="/css/layout.css">
    <script>
        function confirmSubmit(event) {
            if (!confirm("변경사항을 저장하시겠습니까?")) {
                event.preventDefault();
            }
        }
        window.onload = function() {
            var form = document.getElementById("user-auth");
            form.addEventListener("submit", confirmSubmit);
        }
    </script>
</head>
<body>
<aside class="side-bar">
    <section class="side-bar__icon-box">
        <section class="side-bar__icon-1">
            <div></div>
            <div></div>
            <div></div>
        </section>
    </section>
    <ul>
        <li>
            <a th:href="@{/admin/user-list}">
                <span><i class="fa-solid fa-cat"></i></span>
                <span>회원 관리</span>
            </a>
            <ul>
                <li><a th:href="@{/admin/user-list}">회원 목록</a></li>
            </ul>
        </li>
        <li>
            <a th:href="@{/0/main}">
                <span><i class="fa-solid fa-dragon"></i></span>
                <span>게시판 관리</span>
            </a>
            <ul>
                <li><a th:href="@{/0/main}">공지사항 게시판</a></li>
                <li><a th:href="@{/1/main}">QnA 게시판</a></li>
            </ul>
        </li>
    </ul>
    <!-- 로그인/로그아웃 버튼 추가 -->
    <div class="side-bar__login">
        <div th:if="${#httpServletRequest.remoteUser != null}" class="text-center">
            <span th:text="${#httpServletRequest.remoteUser}">ㅇㅇㅇ</span> 님 환영합니다!<br><br>
        </div>
        <div th:if="${#httpServletRequest.remoteUser != null}" class="text-center">
            <!-- 사용자가 로그인한 경우 -->
            <input type="button" value="로그아웃" onclick="location.href='/logout'" class="btn btn-danger">
        </div>
        <div th:if="${#httpServletRequest.remoteUser == null}" class="text-center">
            <!-- 사용자가 로그인하지 않은 경우 -->
            <input type="button" value="로그인" onclick="location.href='/login'" class="btn btn-primary">
            <input type="button" value="회원가입" onclick="location.href='/join'" class="btn btn-success">
        </div>
    </div>
</aside>
<div class="content-area">
    <div class="py-5 text-center">
        <h1>회원 목록</h1>
    </div>
    <table>
        <thead>
        <tr>
            <th>유저번호</th>
            <th>아이디</th>
            <th>이름</th>
            <th>가입일</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user : ${users}">
            <td th:text="${user.idx}">유저번호</td>
            <td><a th:href="@{'/admin/user-info/' + ${user.userId}}" th:text="${user.userId}">아이디</a></td>
            <td th:text="${user.username}">이름</td>
            <td th:text="${user.regdate}">가입일</td>
        </tr>
        </tbody>
    </table>
    <div class="py-5 text-center">
        <h1>게시판 별 접근 권한</h1>
    </div>
    <form id="user-auth" th:action="@{/admin/user-auth}" th:object="${users}" method="post">
        <table>
            <thead>
            <tr>
                <th rowspan="2">사용자 이름</th>
                <th th:each="category : ${categories}">
                    <span th:text="${category.ctgNm}"></span>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.username}"></td>
                <th:block th:each="category : ${categories}">
                    <!-- 수정: 읽기/쓰기 체크박스를 한 열에 표시 -->
                    <td>
                        <input type="checkbox"
                               th:name="'read_' + ${user.idx} + '_' + ${category.ctgNo}"
                               th:checked="${authMap.get(user.idx).get(category.ctgNo).canRead}" />
                        <label>읽기</label>
                        <input type="checkbox"
                               th:name="'write_' + ${user.idx} + '_' + ${category.ctgNo}"
                               th:checked="${authMap.get(user.idx).get(category.ctgNo).canWrite}" />
                        <label>쓰기</label>
                    </td>
                </th:block>
            </tr>
            </tbody>
        </table>
        <br>
        <button type="submit" class="w-100 btn btn-secondary btn-lg">저장</button>

    </form>
</div>
</body>
</html>
